# Inno Setup 安装程序使用指南

## 方案优势

✅ **无需证书** - 不需要购买代码签名证书  
✅ **无需配置** - 用户无需安装任何证书  
✅ **传统方式** - 用户熟悉的 .exe 安装程序  
✅ **完全免费** - Inno Setup 是开源免费软件  
✅ **功能完整** - 支持桌面快捷方式、开始菜单、卸载等

## 前置要求

### 1. 安装 Inno Setup

**下载地址**: https://jrsoftware.org/isdl.php

**安装步骤**:
1. 下载 `innosetup-6.x.x.exe`（选择最新版本）
2. 双击运行安装程序
3. 一路点击"下一步"完成安装
4. 默认安装路径：`C:\Program Files (x86)\Inno Setup 6\`

### 2. 确保 Flutter 环境正常

```bash
flutter doctor
```

确保没有严重错误。

## 构建步骤

### 在 Windows 上构建

```bash
# 1. 进入项目目录
cd /path/to/student_exam

# 2. 运行构建脚本
bash scripts/build_win.sh
```

### 构建过程

脚本会自动执行以下步骤：

1. **清理旧构建** - `flutter clean`
2. **获取依赖** - `flutter pub get`
3. **生成图标** - 运行图标生成脚本
4. **构建应用** - `flutter build windows --release`
5. **创建安装程序** - 使用 Inno Setup 编译

### 构建成功

如果构建成功，你会看到：

```
==========================================
✓ Windows 安装程序已生成成功！
==========================================
文件位置: build/红师教育学生端_setup.exe

特点：
  • 无需证书签名
  • 用户无需安装证书
  • 传统 .exe 安装程序
  • 支持桌面快捷方式
  • 支持开始菜单

分发说明：
  直接将 build/红师教育学生端_setup.exe 发给用户
  用户双击即可安装，无需任何额外操作
==========================================
```

## 安装程序特性

### 用户安装体验

1. **双击运行** - `红师教育学生端_setup.exe`
2. **选择语言** - 默认简体中文
3. **接受协议** - 阅读并接受许可协议
4. **选择路径** - 默认安装到 `C:\Program Files\红师教育学生端\`
5. **选择选项**:
   - ✅ 创建桌面图标（默认勾选）
   - ☐ 创建快速启动图标（默认不勾选）
6. **开始安装** - 自动复制文件
7. **完成安装** - 可选择立即运行程序

### 安装后

- **桌面图标** - 如果勾选了该选项
- **开始菜单** - 在"红师教育学生端"文件夹下
- **卸载程序** - 通过"控制面板"或开始菜单中的"卸载"

## 分发方式

### 方式1：直接分发（推荐）

直接将 `build/红师教育学生端_setup.exe` 发给用户：
- 通过邮件
- 通过网盘（百度网盘、阿里云盘等）
- 通过企业内网
- 通过U盘

### 方式2：网站下载

将安装程序上传到你的网站，用户可以直接下载。

### 方式3：企业分发

通过企业的软件分发系统推送给员工。

## Windows Defender 提示

### 可能的警告

首次运行时，Windows Defender 可能会显示：

```
Windows 已保护你的电脑
Microsoft Defender SmartScreen 已阻止无法识别的应用启动
```

### 解决方法

**用户操作**：
1. 点击"更多信息"
2. 点击"仍要运行"
3. 程序正常安装

**为什么会这样**：
- 这是因为应用没有代码签名证书
- 这不代表应用有病毒或恶意软件
- 这是 Windows 对未签名应用的标准警告

**如何减少警告**：
- 多次下载和安装后，Windows 会建立信任
- 企业内网分发通常不会有此警告
- 如果需要完全消除警告，可以购买代码签名证书

## 更新版本

### 修改版本号

编辑 `scripts/build_win.sh`，找到：

```bash
#define MyAppVersion "1.1.0"
```

修改为新版本号，例如：

```bash
#define MyAppVersion "1.2.0"
```

### 重新构建

```bash
bash scripts/build_win.sh
```

新的安装程序会覆盖旧版本。

## 常见问题

### Q1: 构建失败，提示找不到 Inno Setup

**A**: 确保已安装 Inno Setup 6，并且安装在默认路径：
```
C:\Program Files (x86)\Inno Setup 6\
```

### Q2: 用户安装时提示需要管理员权限

**A**: 这是正常的，因为要安装到 `Program Files` 目录。用户点击"是"即可。

如果不想要求管理员权限，可以修改安装路径为用户目录：
```bash
DefaultDirName={localappdata}\{#MyAppName}
```

### Q3: 安装程序太大

**A**: 当前配置已使用最大压缩（lzma2/max），这是最优的。如果还是太大，考虑：
- 移除不必要的资源文件
- 使用在线更新机制，只分发核心文件

### Q4: 如何添加自定义图标

**A**: 将图标文件（.ico 格式）放在项目中，然后修改脚本：
```bash
SetupIconFile=path\to\your\icon.ico
```

### Q5: 如何添加许可协议

**A**: 创建 `LICENSE.txt` 文件，然后在脚本中添加：
```bash
[Setup]
LicenseFile=LICENSE.txt
```

## 技术支持

如有问题，请联系开发团队。

---

**最后更新**: 2026-01-09
